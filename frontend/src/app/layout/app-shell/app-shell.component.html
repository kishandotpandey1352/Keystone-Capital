<div class="screen">
  <div class="overlay" [class.show]="sidebarOpen || profileOpen" (click)="closeSidebar(); closeProfile()"></div>

  <aside class="sidebar" [class.open]="sidebarOpen">
    <div class="sidebar-header">
      <div class="logo">K</div>
      <div>
        <div class="title">PrismAlpha</div>
        <div class="subtitle">Signals & Insights</div>
      </div>
      <button class="icon-btn" (click)="closeSidebar()">âœ•</button>
    </div>

    <div class="section">
      <div class="section-title">Core</div>
      <button
        class="menu-pill"
        [class.active]="currentMenu === 'our-picks'"
        (click)="selectMenu('our-picks')"
      >
        â­ Our Picks
      </button>
      <button class="menu-item" [class.active]="currentMenu === 'dashboard'" (click)="selectMenu('dashboard')">
        <span class="dot gray">ğŸ“Š</span>
        Dashboard
      </button>
      <button class="menu-item" [class.active]="currentMenu === 'watchlists'" (click)="selectMenu('watchlists')">
        <span class="dot teal">ğŸ“Œ</span>
        Watchlists
      </button>
      <button class="menu-item" [class.active]="currentMenu === 'portfolio'" (click)="selectMenu('portfolio')">
        <span class="dot navy">ğŸ’¼</span>
        Portfolio
      </button>
      <button class="menu-item" [class.active]="currentMenu === 'alerts'" (click)="selectMenu('alerts')">
        <span class="dot orange">ğŸ””</span>
        Alerts
      </button>
    </div>

    <div class="section">
      <div class="section-title">Signals</div>
      <button class="menu-item" [class.active]="currentMenu === 'upside-breakout'" (click)="selectMenu('upside-breakout')">
        <span class="dot green">â¬†</span>
        Upside Breakout
      </button>
      <button class="menu-item" [class.active]="currentMenu === 'downside-breakout'" (click)="selectMenu('downside-breakout')">
        <span class="dot orange">â¬‡</span>
        Downside Breakout
      </button>
      <button class="menu-item" [class.active]="currentMenu === 'profitability'" (click)="selectMenu('profitability')">
        <span class="dot gold">$</span>
        Profitability
      </button>
      <button class="menu-item" [class.active]="currentMenu === 'market-similarity'" (click)="selectMenu('market-similarity')">
        <span class="dot blue">â›°</span>
        Market Similarity
      </button>
      <button class="menu-item" [class.active]="currentMenu === 'growth'" (click)="selectMenu('growth')">
        <span class="dot purple">ğŸ“ˆ</span>
        Growth
      </button>
      <button class="menu-item" [class.active]="currentMenu === 'net-options'" (click)="selectMenu('net-options')">
        <span class="dot violet">âš™</span>
        Net Options Sentiment
      </button>
      <button class="menu-item" [class.active]="currentMenu === 'net-social'" (click)="selectMenu('net-social')">
        <span class="dot teal">ğŸ’¬</span>
        Net Social Sentiment
      </button>
      <button class="menu-item" [class.active]="currentMenu === 'technical-flow'" (click)="selectMenu('technical-flow')">
        <span class="dot gray">ğŸ“Š</span>
        Technical Flow
      </button>
      <button class="menu-item" [class.active]="currentMenu === 'dark-pool'" (click)="selectMenu('dark-pool')">
        <span class="dot navy">â–µ</span>
        Dark Pool Rating
      </button>
      <button class="menu-item" [class.active]="currentMenu === 'short-pressure'" (click)="selectMenu('short-pressure')">
        <span class="dot red">âš¡</span>
        Short Pressure Rating
      </button>
    </div>

    <div class="section">
      <div class="section-title">Discover</div>
      <button class="menu-item" [class.active]="currentMenu === 'screeners'" (click)="selectMenu('screeners')">
        <span class="dot blue">ğŸ”</span>
        Screeners
      </button>
      <button class="menu-item" [class.active]="currentMenu === 'market-news'" (click)="selectMenu('market-news')">
        <span class="dot gold">ğŸ“°</span>
        Market News
      </button>
      <button class="menu-item" [class.active]="currentMenu === 'earnings-calendar'" (click)="selectMenu('earnings-calendar')">
        <span class="dot purple">ğŸ“…</span>
        Earnings Calendar
      </button>
      <button class="menu-item" [class.active]="currentMenu === 'education'" (click)="selectMenu('education')">
        <span class="dot green">ğŸ“</span>
        Learn
      </button>
    </div>
  </aside>

  <header class="topbar">
    <button class="icon-btn menu-btn" (click)="toggleSidebar()" (mouseenter)="openSidebarHover()">â˜°</button>
    <div class="brand">
      <div class="logo">K</div>
      <div>
        <div class="title">PrismAlpha</div>
        <div class="subtitle">Trading intelligence dashboard</div>
      </div>
    </div>

    <div class="topbar-actions">
      <div class="status">
        <span class="pill" [class.ok]="apiStatus === 'ok'" [class.fail]="apiStatus === 'fail'">
          API: {{ apiStatus }}
        </span>
        <span class="pill" [class.ok]="wsStatus === 'connected'" [class.fail]="wsStatus === 'error'">
          WS: {{ wsStatus }}
        </span>
      </div>

      <div class="country-toggle">
        <button
          class="country-btn"
          [class.active]="selectedCountry === 'US'"
          (click)="setCountry('US')"
        >
          <img class="country-flag" src="assets/flags/us.svg" alt="US" />
          US
        </button>
        <button
          class="country-btn"
          [class.active]="selectedCountry === 'IN'"
          (click)="setCountry('IN')"
        >
          <img class="country-flag" src="assets/flags/in.svg" alt="India" />
          India
        </button>
      </div>

      <button class="icon-btn profile-btn" (click)="toggleProfile()">ğŸ‘¤</button>
    </div>
  </header>

  <nav class="top-nav">
    <button
      class="top-nav-item"
      [class.active]="currentMenu === 'our-picks'"
      (click)="selectMenu('our-picks')"
    >
      Our Picks
    </button>
    <button
      class="top-nav-item"
      [class.active]="currentMenu === 'dashboard'"
      (click)="selectMenu('dashboard')"
    >
      Dashboard
    </button>
    <button
      class="top-nav-item"
      [class.active]="currentMenu === 'watchlists'"
      (click)="selectMenu('watchlists')"
    >
      Watchlists
    </button>
    <button
      class="top-nav-item"
      [class.active]="currentMenu === 'portfolio'"
      (click)="selectMenu('portfolio')"
    >
      Portfolio
    </button>
    <button
      class="top-nav-item"
      [class.active]="currentMenu === 'alerts'"
      (click)="selectMenu('alerts')"
    >
      Alerts
    </button>
    <button class="top-nav-item more" (click)="toggleSidebar()">More</button>
  </nav>

  <section class="profile-panel" *ngIf="profileOpen">
    <div class="profile-header">
      <div class="profile-avatar">PA</div>
      <div>
        <div class="profile-name">PrismAlpha User</div>
        <div class="profile-email">you@example.com</div>
      </div>
    </div>
    <div class="profile-links">
      <button class="profile-item">
        <span>Account settings</span>
        <span class="chev">â€º</span>
      </button>
      <button class="profile-item">
        <span>App preferences</span>
        <span class="chev">â€º</span>
      </button>
      <button class="profile-item">
        <span>Notifications</span>
        <span class="chev">â€º</span>
      </button>
      <button class="profile-item">
        <span>Learn PrismAlpha</span>
        <span class="chev">â€º</span>
      </button>
      <button class="profile-item">
        <span>Support & Contact</span>
        <span class="chev">â€º</span>
      </button>
      <button class="profile-item danger">
        <span>Log out</span>
        <span class="chev">â€º</span>
      </button>
    </div>
  </section>

  <ng-container *ngIf="currentMenu === 'dashboard'; else menuScreen">
    <app-dashboard [lastMsg]="lastMsg" (sendWs)="sendWs($event)"></app-dashboard>
  </ng-container>

  <ng-template #menuScreen>
    <section class="screen-header">
      <h1>{{ screens[currentMenu]?.title }}</h1>
      <p>{{ getSubtitle(currentMenu) }}</p>
      <div class="updated">Last updated on {{ screens[currentMenu]?.updatedAt }}</div>
    </section>

    <section class="segment" *ngIf="screens[currentMenu]?.tabs?.length && currentMenu !== 'our-picks'">
      <button
        *ngFor="let tab of screens[currentMenu]?.tabs"
        class="segment-btn"
        [class.active]="currentTab === tab"
        (click)="selectTab(tab)"
      >
        {{ tab }}
      </button>
    </section>

    <app-portfolio *ngIf="currentMenu === 'portfolio'"></app-portfolio>

    <app-market-news *ngIf="currentMenu === 'market-news'"></app-market-news>

    <app-watchlists *ngIf="currentMenu === 'watchlists'"></app-watchlists>

    <app-net-social *ngIf="currentMenu === 'net-social'"></app-net-social>


    <section
      class="info-card"
      *ngIf="currentMenu !== 'watchlists' && currentMenu !== 'market-news' && currentMenu !== 'portfolio' && currentMenu !== 'net-social' && !isDescriptionHidden(currentMenu)"
    >
      <div class="info-icon">{{ screens[currentMenu]?.accent }}</div>
      <div>
        <div class="info-title">{{ getDescriptionTitle(currentMenu) }}</div>
        <div class="info-text">{{ getDescriptionText(currentMenu) }}</div>
      </div>
      <button class="info-close" (click)="hideDescription(currentMenu)">âœ•</button>
    </section>

    <button
      class="info-toggle"
      *ngIf="currentMenu !== 'watchlists' && currentMenu !== 'net-social' && isDescriptionHidden(currentMenu)"
      (click)="showDescription(currentMenu)"
      (mouseenter)="showDescription(currentMenu)"
    >
      {{ screens[currentMenu]?.accent }} Show description
    </button>

    <ng-container *ngIf="currentMenu !== 'watchlists' && currentMenu !== 'market-news' && currentMenu !== 'portfolio' && currentMenu !== 'net-social'">
      <section class="stock-card" *ngFor="let s of getStocks(currentMenu)">
        <div class="stock-head">
          <div>
            <div class="stock-symbol">{{ s.symbol }}</div>
            <div class="stock-name">{{ s.name }}</div>
          </div>
          <div class="stock-price">{{ s.price }}</div>
        </div>
        <div class="metric-grid">
          <div class="metric-col">
            <div class="metric-title">LONG-TERM</div>
            <div class="metric" *ngFor="let m of s.longTerm">
              <span>{{ m.label }}</span>
              <span class="metric-value" [class.up]="m.trend === 'up'" [class.down]="m.trend === 'down'">
                {{ m.trend === 'up' ? 'â–²' : m.trend === 'down' ? 'â–¼' : '' }} {{ m.value }}
              </span>
            </div>
          </div>
          <div class="metric-col">
            <div class="metric-title">SHORT-TERM</div>
            <div class="metric" *ngFor="let m of s.shortTerm">
              <span>{{ m.label }}</span>
              <span class="metric-value" [class.up]="m.trend === 'up'" [class.down]="m.trend === 'down'">
                {{ m.trend === 'up' ? 'â–²' : m.trend === 'down' ? 'â–¼' : '' }} {{ m.value }}
              </span>
            </div>
          </div>
        </div>
      </section>
    </ng-container>
  </ng-template>

  <footer
    class="bottom-tabs"
    *ngIf="
      currentMenu === 'our-picks' ||
      currentMenu === 'upside-breakout' ||
      currentMenu === 'downside-breakout' ||
      currentMenu === 'profitability' ||
      currentMenu === 'market-similarity' ||
      currentMenu === 'growth' ||
      currentMenu === 'net-options' ||
      currentMenu === 'technical-flow' ||
      currentMenu === 'dark-pool' ||
      currentMenu === 'short-pressure'
    "
  >
    <mat-tab-group
      class="bottom-tab-group"
      [selectedIndex]="selectedMenuIndex"
      (selectedIndexChange)="onBottomTabChange($event)"
      animationDuration="0ms"
    >
      <mat-tab *ngFor="let tab of bottomTabs">
        <ng-template mat-tab-label>
          <div class="bottom-tab-label">
            <div class="bottom-tab-icon">{{ tab.icon }}</div>
            <div class="bottom-tab-text">{{ tab.label }}</div>
          </div>
        </ng-template>
      </mat-tab>
    </mat-tab-group>
  </footer>
</div>
